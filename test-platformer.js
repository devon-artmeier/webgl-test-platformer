(()=>{"use strict";var t={290:function(t,e,i){var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i);var s=Object.getOwnPropertyDescriptor(e,i);s&&!("get"in s?!e.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,r,s)}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),s=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),s(i(326),e)},429:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ContextPool=void 0;const r=i(562);class s{static get(t){return this.contexts.get(t)}static delete(t){var e;(null===(e=this.bind)||void 0===e?void 0:e.id)==t&&(this.bind=null),this.contexts.delete(t)}}e.ContextPool=s,s.contexts=new r.ResourceManager,s.bind=null},562:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ResourceManager=void 0,e.ResourceManager=class{constructor(){this._pool=new Map}add(t,e){this._pool.has(t)&&(this._pool.get(t).delete(),this._pool.delete(t)),this._pool.set(t,e)}check(t){return this._pool.has(t)}get(t){return this._pool.get(t)}delete(t){this.check(t)&&(this._pool.get(t).delete(),this._pool.delete(t))}clear(){for(const[t,e]of this._pool.entries())e.delete();this._pool.clear()}}},813:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Resource=void 0,e.Resource=class{constructor(t,e){this._context=t,this.id=e}}},533:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Blend=void 0;const r=i(429);class s{static enable(){let t=r.ContextPool.bind;if(null!=t){let e=t.gl;e.enable(e.BLEND)}}static disable(){let t=r.ContextPool.bind;if(null!=t){let e=t.gl;e.disable(e.BLEND)}}static getFunction(t){let e=r.ContextPool.bind;if(null!=e){let i=e.gl;return[i.ZERO,i.ONE,i.SRC_COLOR,i.ONE_MINUS_SRC_COLOR,i.DST_COLOR,i.ONE_MINUS_DST_COLOR,i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.DST_ALPHA,i.ONE_MINUS_DST_ALPHA,i.CONSTANT_COLOR,i.ONE_MINUS_CONSTANT_COLOR,i.CONSTANT_ALPHA,i.ONE_MINUS_CONSTANT_ALPHA][t]}return 0}static setFunction(t,e){let i=r.ContextPool.bind;null!=i&&i.gl.blendFunc(this.getFunction(t),this.getFunction(e))}static setFunctionSeparate(t,e,i,s){let n=r.ContextPool.bind;null!=n&&n.gl.blendFuncSeparate(this.getFunction(t),this.getFunction(e),this.getFunction(i),this.getFunction(s))}}e.Blend=s,s.Zero=0,s.One=1,s.SrcColor=2,s.OneMinusSrcColor=3,s.DestColor=4,s.OneMinusDestColor=5,s.SrcAlpha=6,s.OneMinusSrcAlpha=7,s.DestAlpha=8,s.OneMinusDestAlpha=9,s.ConstantColor=10,s.OneMinusConstantColor=11,s.ConstantAlpha=12,s.OneMinusConstantAlpha=13},558:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Context=void 0;const r=i(813),s=i(562),n=i(429),l=i(512),a=i(599),o=i(942),c=i(709),h=i(178),u=i(936),d=i(955),_=i(529),g=i(532);class v extends _.Vertex{constructor(t,e){super(),this.coord=t,this.tex=e}getData(){return[this.coord,this.tex]}}const x=[new v([0,0],[0,1]),new v([1,1],[1,0]),new v([1,0],[1,1]),new v([0,1],[0,0])],f=[0,1,2,1,0,3];class b extends r.Resource{get currentTexture(){return this._currentTexture}get currentShader(){return this._currentShader}get currentFBO(){return this._currentFBO}get currentVBO(){return this._currentVBO}get currentEBO(){return this._currentEBO}get currentVAO(){return this._currentVAO}constructor(t,e,i){var r;if(super(null,e),this.element=t,this.textures=new s.ResourceManager,this.shaders=new s.ResourceManager,this.meshes=new s.ResourceManager,null!=t){i[0]<=0&&(i[0]=1),i[1]<=0&&(i[1]=1),this._container=document.createElement("div"),this._container.className="devon-webgl-canvas-container",this._container.style.width=`${i[0]}px`,this._container.style.height=`${i[1]}px`,this._container.style.display="block",this._container.style.zIndex="-1",this._canvas=document.createElement("canvas"),this._canvas.className="devon-webgl-canvas-view",this._canvas.style.position="absolute",this._container.appendChild(this._canvas),t.replaceWith(this._container),this.gl=null===(r=this._canvas)||void 0===r?void 0:r.getContext("webgl2",{alpha:!0,stencil:!0,preserveDrawingBuffer:!0});let e=n.ContextPool.bind;n.ContextPool.bind=this;let s=window.devicePixelRatio;i=[Math.round(i[0]*s),Math.round(i[1]*s)],d.Texture.create("fbo_devon_webgl",i),h.Shader.create("shader_devon_webgl","#version 300 es\n\nlayout (location = 0) in vec2 vecFragCoord;\nlayout (location = 1) in vec2 vecTexCoord;\n\nout vec2 texCoord;\n\nuniform mat4 projection;\n\nvoid main(void)\n{\n\ttexCoord = vecTexCoord;\n\tgl_Position = projection * vec4(vecFragCoord, 0, 1);\n}\n","#version 300 es\nprecision highp float;\n\nin vec2 texCoord;\nout vec4 fragColor;\nuniform sampler2D renderTexture;\n\nvoid main(void)\n{\n\tfragColor = texture(renderTexture, texCoord);\n}\n"),c.Mesh.createStatic("mesh_devon_webgl",x,f),n.ContextPool.bind=e,b._fullscreenInit||(document.addEventListener("fullscreenchange",(function(){b._fullscreen=!b._fullscreen,b._fullscreen||window.scrollTo(b._savedScroll[0],b._savedScroll[1])})),b._fullscreenInit=!0)}}bind(){const t=this._container.getBoundingClientRect();let e=window.devicePixelRatio;this._canvas.width=Math.round(t.width*e),this._canvas.height=Math.round(t.height*e),b._fullscreen?(this._canvas.style.left=`${t.left}px`,this._canvas.style.top=`${t.top}px`):(this._canvas.style.left=`${window.scrollX+t.left}px`,this._canvas.style.top=`${window.scrollY+t.top}px`),this._canvas.style.width=this._canvas.width/e+"px",this._canvas.style.height=this._canvas.height/e+"px";let i=d.Texture.getSize("fbo_devon_webgl");i[0]==this._canvas.width&&i[1]==this._canvas.height||(i=[this._canvas.width,this._canvas.height],d.Texture.createBlank("fbo_devon_webgl",[this._canvas.width,this._canvas.height])),d.Texture.setRenderTarget("fbo_devon_webgl")}draw(){this._currentFBO=null,this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),g.Viewport.set([0,0],[this._canvas.width,this._canvas.height]),a.Depth.disable(),u.Stencil.disable(),u.Stencil.setMask(255),u.Stencil.setFunction(u.Stencil.Always,1,255),l.Cull.disable();let t=o.Matrix.ortho([0,0],[1,1],[0,1]);h.Shader.bind("shader_devon_webgl"),h.Shader.setTexture("renderTexture",-1),h.Shader.setMatrix4("projection",t),d.Texture.setActive(-1,"fbo_devon_webgl"),c.Mesh.draw("mesh_devon_webgl")}resize(t){this._container.style.width=`${t[0]}px`,this._container.style.height=`${t[1]}px`}getSize(){return d.Texture.getSize("fbo_devon_webgl")}bindTexture(t){this._currentTexture!=t&&(this._currentTexture=t,this.gl.bindTexture(this.gl.TEXTURE_2D,t))}bindShader(t){this._currentShader!=t&&(this._currentShader=t,this.gl.useProgram(t))}bindFramebuffer(t){null==t?d.Texture.setRenderTarget("fbo_devon_webgl"):this._currentFBO!=t&&(this._currentFBO=t,this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,t))}bindVertexBuffer(t){this._currentVBO!=t&&(this._currentVBO=t,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t))}bindElementBuffer(t){this._currentEBO!=t&&(this._currentEBO=t,this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,t))}bindVertexArray(t){this._currentVAO!=t&&(this._currentVAO=t,this.gl.bindVertexArray(t))}deleteTexture(t){null!=t&&(this._currentTexture==t&&this.bindTexture(null),this.gl.deleteTexture(t))}deleteShader(t){null!=t&&(this._currentShader==t&&this.bindShader(null),this.gl.deleteProgram(t))}deleteFramebuffer(t){null!=t&&(this._currentFBO==t&&this.bindFramebuffer(null),this.gl.deleteFramebuffer(t))}deleteVertexBuffer(t){null!=t&&(this._currentVBO==t&&this.bindVertexBuffer(null),this.gl.deleteBuffer(t))}deleteElementBuffer(t){null!=t&&(this._currentEBO==t&&this.bindElementBuffer(null),this.gl.deleteBuffer(t))}deleteVertexArray(t){null!=t&&(this._currentVAO==t&&this.bindVertexArray(null),this.gl.deleteVertexArray(t))}delete(){this.textures.clear(),this.shaders.clear(),this.meshes.clear()}static create(t,e,i){let r=new b(e,t,i);n.ContextPool.contexts.add(t,r)}static bind(t){let e=n.ContextPool.get(t);null!=e&&(n.ContextPool.bind=e,e.bind())}static clear(t){let e=n.ContextPool.bind;if(null!=e){let i=e.gl;i.clearColor(...t),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT|i.STENCIL_BUFFER_BIT)}}static draw(){var t;null===(t=n.ContextPool.bind)||void 0===t||t.draw()}static resize(t){var e;null===(e=n.ContextPool.bind)||void 0===e||e.resize(t)}static getSize(){var t;return null===(t=n.ContextPool.bind)||void 0===t?void 0:t.getSize()}static setFullscreen(t){let e=n.ContextPool.get(t);null!=e&&(e._container.requestFullscreen(),this._savedScroll=[window.scrollX,window.scrollY])}static getContainer(t){var e;return null===(e=n.ContextPool.get(t))||void 0===e?void 0:e._container}static getCanvas(t){var e;return null===(e=n.ContextPool.get(t))||void 0===e?void 0:e._canvas}static delete(t){n.ContextPool.delete(t)}}e.Context=b},512:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Cull=void 0;const r=i(429);class s{static enable(){let t=r.ContextPool.bind;if(null!=t){let e=t.gl;e.enable(e.CULL_FACE)}}static disable(){let t=r.ContextPool.bind;if(null!=t){let e=t.gl;e.disable(e.CULL_FACE)}}static setFace(t){let e=r.ContextPool.bind;if(null!=e){let i=e.gl;i.cullFace([i.FRONT,i.BACK,i.FRONT_AND_BACK][t])}}static setFront(t){let e=r.ContextPool.bind;if(null!=e){let i=e.gl;i.frontFace([i.CW,i.CCW][t])}}}e.Cull=s,s.Front=0,s.Back=1,s.FrontBack=1,s.Clockwise=0,s.CounterClockwise=1},599:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Depth=void 0;const r=i(429);class s{static enable(){let t=r.ContextPool.bind;if(null!=t){let e=t.gl;e.enable(e.DEPTH_TEST)}}static disable(){let t=r.ContextPool.bind;if(null!=t){let e=t.gl;e.disable(e.DEPTH_TEST)}}static clear(){let t=r.ContextPool.bind;if(null!=t){let e=t.gl;e.clear(e.DEPTH_BUFFER_BIT)}}static setFunction(t){let e=r.ContextPool.bind;if(null!=e){let i=e.gl;i.depthFunc([i.ALWAYS,i.NEVER,i.EQUAL,i.NOTEQUAL,i.LESS,i.LEQUAL,i.GREATER,i.GEQUAL][t])}}static setMask(t){let e=r.ContextPool.bind;null!=e&&e.gl.depthMask(t)}}e.Depth=s,s.Always=0,s.Never=1,s.Equal=2,s.NotEqual=3,s.Less=4,s.LessEqual=5,s.Greater=6,s.GreaterEqual=7},326:function(t,e,i){var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i);var s=Object.getOwnPropertyDescriptor(e,i);s&&!("get"in s?!e.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,r,s)}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),s=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),s(i(533),e),s(i(558),e),s(i(512),e),s(i(599),e),s(i(942),e),s(i(709),e),s(i(754),e),s(i(178),e),s(i(936),e),s(i(955),e),s(i(425),e),s(i(818),e),s(i(529),e),s(i(532),e)},942:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Matrix=void 0;const r=i(818);e.Matrix=class{static ortho(t,e,i){let r=t[0],s=t[0]+e[0],n=t[1],l=t[1]+e[1];return[2/(s-r),0,0,0,0,2/(n-l),0,0,0,0,-2/(i[1]-i[0]),0,-(s+r)/(s-r),-(n+l)/(n-l),0,1]}static perspective(t,e,i){let r=1/Math.tan(t*(Math.PI/180)/2),s=1/(i[1]-i[0]);return[1/(e[0]/e[1])*r,0,0,0,0,r,0,0,0,0,-(i[1]+i[0])*s,-1,0,0,-2*i[1]*i[0]*s,0]}static multiplyVector(t,e){return[t[0]*e[0]+t[4]*e[1]+t[8]*e[2]+t[12]*e[3],t[1]*e[0]+t[5]*e[1]+t[9]*e[2]+t[13]*e[3],t[2]*e[0]+t[6]*e[1]+t[10]*e[2]+t[14]*e[3],t[3]*e[0]+t[7]*e[1]+t[11]*e[2]+t[15]*e[3]]}static multiply(t,e){return[t[0]*e[0]+t[4]*e[1]+t[8]*e[2]+t[12]*e[3],t[1]*e[0]+t[5]*e[1]+t[9]*e[2]+t[13]*e[3],t[2]*e[0]+t[6]*e[1]+t[10]*e[2]+t[14]*e[3],t[3]*e[0]+t[7]*e[1]+t[11]*e[2]+t[15]*e[3],t[0]*e[4]+t[4]*e[5]+t[8]*e[6]+t[12]*e[7],t[1]*e[4]+t[5]*e[5]+t[9]*e[6]+t[13]*e[7],t[2]*e[4]+t[6]*e[5]+t[10]*e[6]+t[14]*e[7],t[3]*e[4]+t[7]*e[5]+t[11]*e[6]+t[15]*e[7],t[0]*e[8]+t[4]*e[9]+t[8]*e[10]+t[12]*e[11],t[1]*e[8]+t[5]*e[9]+t[9]*e[10]+t[13]*e[11],t[2]*e[8]+t[6]*e[9]+t[10]*e[10]+t[14]*e[11],t[3]*e[8]+t[7]*e[9]+t[11]*e[10]+t[15]*e[11],t[0]*e[12]+t[4]*e[13]+t[8]*e[14]+t[12]*e[15],t[1]*e[12]+t[5]*e[13]+t[9]*e[14]+t[13]*e[15],t[2]*e[12]+t[6]*e[13]+t[10]*e[14]+t[14]*e[15],t[3]*e[12]+t[7]*e[13]+t[11]*e[14]+t[15]*e[15]]}static view3D(t,e,i){let s=r.Vector.normalize3([t[0]-e[0],t[1]-e[1],t[2]-e[2]]),n=r.Vector.cross([i[0],i[1],i[2]],[s[0],s[1],s[2]]),l=r.Vector.normalize3([n[0],n[1],n[2]]),a=r.Vector.cross([s[0],s[1],s[2]],[l[0],l[1],l[2]]),o=-r.Vector.dot3([l[0],l[1],l[2]],[t[0],t[1],t[2]]),c=-r.Vector.dot3([a[0],a[1],a[2]],[t[0],t[1],t[2]]),h=-r.Vector.dot3([s[0],s[1],s[2]],[t[0],t[1],t[2]]);return[l[0],l[1],l[2],0,a[0],a[1],a[2],0,s[0],s[1],s[2],0,o,c,h,1]}static view2D(t){return[1,0,0,0,0,1,0,0,0,0,1,0,t[0],t[1],0,1]}static translate(t){return[1,0,0,0,0,1,0,0,0,0,1,0,t[0],t[1],t[2],1]}static translate2D(t){return this.translate([t[0],t[1],0])}static translateX(t){return this.translate([t,0,0])}static translateY(t){return this.translate([0,t,0])}static translateZ(t){return this.translate([0,0,t])}static rotate(t){let e=this.rotateX(t[0]);return e=this.multiply(e,this.rotateY(t[1])),e=this.multiply(e,this.rotateZ(t[2])),e}static rotate2D(t){return this.rotateZ(t)}static rotateX(t){let e=Math.sin(t),i=Math.cos(t);return[1,0,0,0,0,i,e,0,0,-e,i,0,0,0,0,1]}static rotateY(t){let e=Math.sin(t),i=Math.cos(t);return[i,0,-e,0,0,1,0,0,e,0,i,0,0,0,0,1]}static rotateZ(t){let e=Math.sin(t),i=Math.cos(t);return[i,e,0,0,-e,i,0,0,0,0,1,0,0,0,0,1]}static scale(t){return[t[0],0,0,0,0,t[1],0,0,0,0,t[2],0,0,0,0,1]}static scale2D(t){return this.scale([t[0],t[1],1])}static scaleX(t){return this.scale([t,1,1])}static scaleY(t){return this.scale([1,t,1])}static scaleZ(t){return this.scale([1,1,t])}static transform3D(t,e,i){let r=this.translate(t);return r=this.multiply(r,this.rotate(e)),r=this.multiply(r,this.scale(i)),r}static transform2D(t,e,i){let r=this.translate2D(t);return r=this.multiply(r,this.rotate2D(e)),r=this.multiply(r,this.scale2D(i)),r}}},709:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Mesh=void 0;const r=i(813),s=i(429);class n extends r.Resource{get vertices(){return this._dynamic?this._vertices:this._vertices.map((t=>Object.assign({},t)))}get elements(){return this._dynamic?this._elements:this._elements.map((t=>Object.assign({},t)))}constructor(t,e,i){super(t,e),this._dynamic=i,this._vertices=new Array,this._elements=new Array;let r=this._context.gl;this._vao=r.createVertexArray()}createVBO(){if(this._vertices.length>0){let t=this._context.gl;this._vbo=t.createBuffer(),this._context.bindVertexArray(this._vao),this._context.bindVertexBuffer(this._vbo),t.bufferData(t.ARRAY_BUFFER,this.getRawVertexData(),this._dynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW);let e=0,i=this._vertices[0],r=i.getLength();for(let s=0;s<i.getAttributeCount();s++){let n=i.getAttributeLength(s);t.enableVertexAttribArray(s),t.vertexAttribPointer(s,n,t.FLOAT,!1,4*r,4*e),e+=n}this._context.bindVertexArray(null),this._context.bindVertexBuffer(null)}this._prevVBOLen=this._vertices.length}createEBO(){if(this._elements.length>0){let t=this._context.gl;this._ebo=t.createBuffer(),this._context.bindVertexArray(this._vao),this._context.bindElementBuffer(this._ebo),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.getRawElementData(),this._dynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW),this._context.bindVertexArray(null),this._context.bindElementBuffer(null)}this._prevEBOLen=this._elements.length}getRawVertexData(){if(0==this._vertices.length)return new Float32Array(0);let t=this._vertices[0].getLength(),e=new Float32Array(this._vertices.length*t);for(let i=0;i<this._vertices.length;i++)e.set(this._vertices[i].getData().flat(),i*t);return e}getRawElementData(){return Uint16Array.from(this._elements)}setData(t,e,i,r){if(r||this._dynamic){let r=t.length-Math.max(0,i+t.length-e.length),s=0;for(;s<r;)e[s+i]=t[s],s++;for(let i=0;i<t.length-r;i++)e.push(t[s++])}}setVertexArray(t,e,i){this.setData(t,this._vertices,e,i)}setElementArray(t,e,i){this.setData(t,this._elements,e,i)}clearVertices(t){this._dynamic&&(this._vertices=new Array(t))}clearElements(t){this._dynamic&&(this._elements=new Array(t))}flushVertices(){if(this._dynamic&&null!=this._vbo){let t=this._context.gl;if(this._elements.length>0){this._context.bindVertexBuffer(this._vbo);let e=this.getRawVertexData();this._prevVBOLen==this._vertices.length?t.bufferSubData(t.ARRAY_BUFFER,0,e):t.bufferData(t.ARRAY_BUFFER,e,t.DYNAMIC_DRAW),this._context.bindVertexBuffer(null)}else this._context.deleteVertexBuffer(this._vbo),this._vbo=null}else this.createVBO();this._prevVBOLen=this._vertices.length}flushElements(){if(this._dynamic&&null!=this._ebo){let t=this._context.gl;if(this._elements.length>0){this._context.bindElementBuffer(this._ebo);let e=this.getRawElementData();this._prevEBOLen==this._elements.length?t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e):t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.DYNAMIC_DRAW),this._context.bindElementBuffer(null)}else this._context.deleteElementBuffer(this._ebo),this._ebo=null}else this.createEBO();this._prevEBOLen=this._elements.length}draw(){this.partialDraw(0,null!=this._ebo?this._elements.length:this._vertices.length)}partialDraw(t,e){if(null!=this._vbo){let i=this._context.gl;this._context.bindVertexArray(this._vao),null!=this._ebo?i.drawElements(i.TRIANGLES,Math.min(e,this._elements.length),i.UNSIGNED_SHORT,t):i.drawArrays(i.TRIANGLES,t,Math.min(e,this._vertices.length)),this._context.bindVertexArray(null)}}delete(){this._context.deleteVertexArray(this._vao),this._context.deleteVertexBuffer(this._vbo),this._context.deleteElementBuffer(this._ebo)}static getMesh(t){var e;return null===(e=s.ContextPool.bind)||void 0===e?void 0:e.meshes.get(t)}static createStatic(t,e,i){let r=s.ContextPool.bind;if(null!=r){let s=new n(r,t,!1);r.meshes.add(t,s),s.setVertexArray(e,0,!0),null!=i&&s.setElementArray(i,0,!0),s.createVBO(),s.createEBO()}}static createDynamic(t){let e=s.ContextPool.bind;if(null!=e){let i=new n(e,t,!0);e.meshes.add(t,i)}}static getVertices(t){var e;return null===(e=this.getMesh(t))||void 0===e?void 0:e.vertices}static getElements(t){var e;return null===(e=this.getMesh(t))||void 0===e?void 0:e.elements}static setVertexArray(t,e,i){var r;null===(r=this.getMesh(t))||void 0===r||r.setVertexArray(e,i,!1)}static setElementArray(t,e,i){var r;null===(r=this.getMesh(t))||void 0===r||r.setElementArray(e,i,!1)}static clearVertices(t,e){var i;null===(i=this.getMesh(t))||void 0===i||i.clearVertices(e)}static clearElements(t,e){var i;null===(i=this.getMesh(t))||void 0===i||i.clearElements(e)}static flushVertices(t){var e;null===(e=this.getMesh(t))||void 0===e||e.flushVertices()}static flushElements(t){var e;null===(e=this.getMesh(t))||void 0===e||e.flushElements()}static flushData(t){let e=this.getMesh(t);null!=e&&(e.flushVertices(),e.flushElements())}static draw(t){var e;null===(e=this.getMesh(t))||void 0===e||e.draw()}static partialDraw(t,e,i){var r;null===(r=this.getMesh(t))||void 0===r||r.partialDraw(e,i)}static delete(t){var e;null===(e=s.ContextPool.bind)||void 0===e||e.meshes.delete(t)}static clear(){var t;null===(t=s.ContextPool.bind)||void 0===t||t.meshes.clear()}}e.Mesh=n},754:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Scissor=void 0;const r=i(429),s=i(532);e.Scissor=class{static enable(){let t=r.ContextPool.bind;if(null!=t){let e=t.gl;e.enable(e.SCISSOR_TEST)}}static disable(){let t=r.ContextPool.bind;if(null!=t){let e=t.gl;e.disable(e.SCISSOR_TEST)}}static setRegion(t,e){let i=r.ContextPool.bind;if(null!=i){let r=i.gl,n=s.Viewport.get();r.scissor(t[0],n[3]-t[1]-t[0],...e)}}}},178:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Shader=void 0;const r=i(813),s=i(429);class n extends r.Resource{constructor(t,e,i,r){super(t,e);let s=this._context.gl,n=s.createShader(s.VERTEX_SHADER);s.shaderSource(n,i),s.compileShader(n);let l=s.createShader(s.FRAGMENT_SHADER);s.shaderSource(l,r),s.compileShader(l),this._program=s.createProgram(),s.attachShader(this._program,n),s.attachShader(this._program,l),s.linkProgram(this._program),s.deleteShader(n),s.deleteShader(l)}delete(){this._context.deleteShader(this._program)}static create(t,e,i){let r=s.ContextPool.bind;if(null!=r){let s=new n(r,t,e,i);r.shaders.add(t,s)}}static bind(t){let e=s.ContextPool.bind;null!=e&&e.bindShader(e.shaders.get(t)._program)}static unbind(){var t;null===(t=s.ContextPool.bind)||void 0===t||t.bindShader(null)}static getUniform(t){var e,i;null===(e=s.ContextPool.bind)||void 0===e||e.gl.getUniform(null===(i=s.ContextPool.bind)||void 0===i?void 0:i.currentShader,t)}static getUniformLocation(t){var e,i;return null===(e=s.ContextPool.bind)||void 0===e?void 0:e.gl.getUniformLocation(null===(i=s.ContextPool.bind)||void 0===i?void 0:i.currentShader,t)}static setFloat(t,e){var i;null===(i=s.ContextPool.bind)||void 0===i||i.gl.uniform1f(this.getUniformLocation(t),e)}static setInt(t,e){var i;null===(i=s.ContextPool.bind)||void 0===i||i.gl.uniform1i(this.getUniformLocation(t),e)}static setVec2(t,e){var i;null===(i=s.ContextPool.bind)||void 0===i||i.gl.uniform2fv(this.getUniformLocation(t),e)}static setIVec2(t,e){var i;null===(i=s.ContextPool.bind)||void 0===i||i.gl.uniform2iv(this.getUniformLocation(t),e)}static setVec3(t,e){var i;null===(i=s.ContextPool.bind)||void 0===i||i.gl.uniform3fv(this.getUniformLocation(t),e)}static setIVec3(t,e){var i;null===(i=s.ContextPool.bind)||void 0===i||i.gl.uniform3iv(this.getUniformLocation(t),e)}static setVec4(t,e){var i;null===(i=s.ContextPool.bind)||void 0===i||i.gl.uniform4fv(this.getUniformLocation(t),e)}static setIVec4(t,e){var i;null===(i=s.ContextPool.bind)||void 0===i||i.gl.uniform4iv(this.getUniformLocation(t),e)}static setMatrix2(t,e){var i;null===(i=s.ContextPool.bind)||void 0===i||i.gl.uniformMatrix2fv(this.getUniformLocation(t),!1,e)}static setMatrix3(t,e){var i;null===(i=s.ContextPool.bind)||void 0===i||i.gl.uniformMatrix3fv(this.getUniformLocation(t),!1,e)}static setMatrix4(t,e){var i;null===(i=s.ContextPool.bind)||void 0===i||i.gl.uniformMatrix4fv(this.getUniformLocation(t),!1,e)}static setTexture(t,e){this.setInt(t,e+1)}static delete(t){var e;null===(e=s.ContextPool.bind)||void 0===e||e.shaders.delete(t)}static clear(){var t;null===(t=s.ContextPool.bind)||void 0===t||t.shaders.clear()}}e.Shader=n},936:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Stencil=void 0;const r=i(429);class s{static enable(){let t=r.ContextPool.bind;if(null!=t){let e=t.gl;e.enable(e.STENCIL_TEST)}}static disable(){let t=r.ContextPool.bind;if(null!=t){let e=t.gl;e.disable(e.STENCIL_TEST)}}static clear(){let t=r.ContextPool.bind;if(null!=t){let e=t.gl;e.clear(e.STENCIL_BUFFER_BIT)}}static setFunction(t,e,i){let s=r.ContextPool.bind;if(null!=s){let r=s.gl;r.stencilFunc([r.ALWAYS,r.NEVER,r.EQUAL,r.NOTEQUAL,r.LESS,r.LEQUAL,r.GREATER,r.GEQUAL][t],e,i)}}static setOptions(t,e,i){let s=r.ContextPool.bind;if(null!=s){let r=s.gl,n=[r.KEEP,r.ZERO,r.REPLACE,r.INCR,r.INCR_WRAP,r.DECR,r.DECR_WRAP,r.INVERT];r.stencilOp(n[t],n[e],n[i])}}static setMask(t){let e=r.ContextPool.bind;null!=e&&e.gl.stencilMask(t)}}e.Stencil=s,s.Always=0,s.Never=1,s.Equal=2,s.NotEqual=3,s.Less=4,s.LessEqual=5,s.Greater=6,s.GreaterEqual=7,s.Keep=0,s.Zero=1,s.Replace=2,s.Increase=3,s.IncreaseWrap=4,s.Decrease=5,s.DecreaseWrap=6,s.Invert=7},955:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Texture=void 0;const r=i(813),s=i(429);class n extends r.Resource{get size(){return[this._size[0],this._size[1]]}get width(){return this._size[0]}get height(){return this._size[1]}get filter(){return this._filter}get minFilter(){return this._filter[0]}get magFilter(){return this._filter[1]}get wrap(){return this._wrap}get wrapX(){return this._wrap[0]}get wrapY(){return this._wrap[1]}constructor(t,e,i){super(t,e),this._size=[0,0],this._filter=[n.Bilinear,n.Bilinear],this._wrap=[n.Clamp,n.Clamp];let r=this._context.gl;this._texture=r.createTexture(),this._context.bindTexture(this._texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),this.createBlank(i)}setFilter(t){this.setMinFilter(t),this.setMagFilter(t)}setMinFilter(t){let e=this._context.gl;this._context.bindTexture(this._texture),this._filter[0]=t;let i=[e.NEAREST,e.LINEAR,e.NEAREST_MIPMAP_LINEAR,e.LINEAR_MIPMAP_LINEAR];e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,i[t+(this._hasMipmap?2:0)])}setMagFilter(t){let e=this._context.gl;this._context.bindTexture(this._texture),this._filter[1]=t;let i=[e.NEAREST,e.LINEAR];e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,i[t])}getWrapMode(t){let e=this._context.gl;return[e.CLAMP_TO_EDGE,e.REPEAT,e.MIRRORED_REPEAT][t]}setWrap(t){this.setWrapX(t),this.setWrapY(t)}setWrapX(t){let e=this._context.gl;this._context.bindTexture(this._texture),this._wrap[0]=t,e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,this.getWrapMode(t))}setWrapY(t){let e=this._context.gl;this._context.bindTexture(this._texture),this._wrap[1]=t,e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,this.getWrapMode(t))}setRenderTarget(){let t=this._context.gl;null==this._fbo?(this._fbo=t.createFramebuffer(),null==this._depthBuffer&&(this._depthBuffer=t.createTexture()),this._context.bindTexture(this._depthBuffer),t.texImage2D(t.TEXTURE_2D,0,t.DEPTH24_STENCIL8,this._size[0],this._size[1],0,t.DEPTH_STENCIL,t.UNSIGNED_INT_24_8,null),this._context.bindFramebuffer(this._fbo),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this._texture,0),t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,this._depthBuffer,0)):this._context.bindFramebuffer(this._fbo),this.setMipmapCreate(!1)}createBlank(t){let e=this._context.gl;if(this._context.bindTexture(this._texture),t[0]<=0&&(t[0]=1),t[1]<=0&&(t[1]=1),t[0]!=this._size[0]||t[1]!=this._size[1]?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t[0],t[1],0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(t[0]*t[1]*4)):e.texSubImage2D(e.TEXTURE_2D,0,0,0,t[0],t[1],e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(t[0]*t[1]*4)),this._size=t,null!=this._fbo){let t=this._context.currentFBO;this._context.deleteFramebuffer(this._fbo),this._fbo=null,this.setRenderTarget(),this._context.bindFramebuffer(t)}else this.setMipmapCreate(!1)}loadImageFile(t){let e=new Image;e.crossOrigin="anonymous",e.src=t,e.onload=()=>{let t=this._context.currentTexture;this.loadImage(e),this._context.bindTexture(t)}}loadImage(t){let e=this._context.gl;this._context.bindTexture(this._texture),t.width!=this._size[0]||t.height!=this._size[1]?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t):e.texSubImage2D(e.TEXTURE_2D,0,0,0,t.width,t.height,e.RGBA,e.UNSIGNED_BYTE,t),this._size=[t.width,t.height],this.setMipmapCreate(!1)}loadVideoFrame(t){if(0!=t.videoWidth&&0!=t.videoHeight){let e=this._context.gl;this._context.bindTexture(this._texture),t.videoWidth!=this._size[0]||t.videoHeight!=this._size[1]?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t):e.texSubImage2D(e.TEXTURE_2D,0,0,0,t.videoWidth,t.videoHeight,e.RGBA,e.UNSIGNED_BYTE,t),this._size=[t.videoWidth,t.videoHeight],this.setMipmapCreate(!1)}}createMipmap(){let t=this._context.gl;this._context.bindTexture(this._texture),t.generateMipmap(t.TEXTURE_2D),this.setMipmapCreate(!0)}setMipmapCreate(t){this._hasMipmap=t,this.setMinFilter(this._filter[0])}delete(){this._context.deleteTexture(this._texture),this._context.deleteFramebuffer(this._fbo),this._context.deleteTexture(this._depthBuffer)}static getTexture(t){var e;return null===(e=s.ContextPool.bind)||void 0===e?void 0:e.textures.get(t)}static create(t,e=[1,1]){let i=s.ContextPool.bind;if(null!=i){let r=new n(i,t,e);i.textures.add(t,r)}}static getSize(t){var e;return null===(e=this.getTexture(t))||void 0===e?void 0:e.size}static getWidth(t){var e;return null===(e=this.getTexture(t))||void 0===e?void 0:e.width}static getHeight(t){var e;return null===(e=this.getTexture(t))||void 0===e?void 0:e.height}static getFilter(t){var e;return console.log(this.getTexture(t)),null===(e=this.getTexture(t))||void 0===e?void 0:e.filter}static getMinFilter(t){var e;return null===(e=this.getTexture(t))||void 0===e?void 0:e.minFilter}static getMagFilter(t){var e;return null===(e=this.getTexture(t))||void 0===e?void 0:e.magFilter}static getWrap(t){var e;return null===(e=this.getTexture(t))||void 0===e?void 0:e.wrap}static getWrapX(t){var e;return null===(e=this.getTexture(t))||void 0===e?void 0:e.wrapX}static getWrapY(t){var e;return null===(e=this.getTexture(t))||void 0===e?void 0:e.wrapY}static setFilter(t,e){var i;null===(i=this.getTexture(t))||void 0===i||i.setFilter(e)}static setMinFilter(t,e){var i;null===(i=this.getTexture(t))||void 0===i||i.setMinFilter(e)}static setMagFilter(t,e){var i;null===(i=this.getTexture(t))||void 0===i||i.setMagFilter(e)}static setWrap(t,e){var i;null===(i=this.getTexture(t))||void 0===i||i.setWrap(e)}static setWrapX(t,e){var i;null===(i=this.getTexture(t))||void 0===i||i.setWrapX(e)}static setWrapY(t,e){var i;null===(i=this.getTexture(t))||void 0===i||i.setWrapY(e)}static setActive(t,e){var i;let r=s.ContextPool.bind;if(null!=r){let s=r.gl;s.activeTexture(s.TEXTURE1+t),r.bindTexture(null===(i=this.getTexture(e))||void 0===i?void 0:i._texture),s.activeTexture(s.TEXTURE0)}}static unsetActive(t){let e=s.ContextPool.bind;if(null!=e){let i=e.gl;i.activeTexture(i.TEXTURE1+t),e.bindTexture(null),i.activeTexture(i.TEXTURE0)}}static setRenderTarget(t){var e;null===(e=this.getTexture(t))||void 0===e||e.setRenderTarget()}static unsetRenderTarget(){var t;null===(t=s.ContextPool.bind)||void 0===t||t.bindFramebuffer(null)}static createBlank(t,e){var i;null===(i=this.getTexture(t))||void 0===i||i.createBlank(e)}static loadImageFile(t,e){var i;null===(i=this.getTexture(t))||void 0===i||i.loadImageFile(e)}static loadImage(t,e){var i;null===(i=this.getTexture(t))||void 0===i||i.loadImage(e)}static loadVideoFrame(t,e){var i;null===(i=this.getTexture(t))||void 0===i||i.loadVideoFrame(e)}static createMipmap(t){var e;null===(e=this.getTexture(t))||void 0===e||e.createMipmap()}static delete(t){s.ContextPool.bind.textures.delete(t)}static clear(){s.ContextPool.bind.textures.clear()}}e.Texture=n,n.Nearest=0,n.Bilinear=1,n.Clamp=0,n.Repeat=1,n.Mirror=2},425:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0})},818:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Vector=void 0;class i{static add2(t,e){return[t[0]+e[0],t[1]+e[1]]}static add3(t,e){return[t[0]+e[0],t[1]+e[1],t[2]+e[2]]}static add4(t,e){return[t[0]+e[0],t[1]+e[1],t[2]+e[2],t[3]+e[3]]}static sub2(t,e){return[t[0]-e[0],t[1]-e[1]]}static sub3(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]}static sub4(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3]]}static convert2To3(t,e){return[t[0],t[1],e]}static convert2To4(t,e,i){return[t[0],t[1],e,i]}static convert3To4(t,e){return[t[0],t[1],t[2],e]}static length2(t){return Math.sqrt(i.dot2(t,t))}static length3(t){return Math.sqrt(i.dot3(t,t))}static length4(t){return Math.sqrt(i.dot4(t,t))}static normalize2(t){let e=this.length2(t);return[t[0]/e,t[1]/e]}static normalize3(t){let e=this.length3(t);return[t[0]/e,t[1]/e,t[2]/e]}static normalize4(t){let e=this.length4(t);return[t[0]/e,t[1]/e,t[2]/e,t[3]/e]}static dot2(t,e){return t[0]*e[0]+t[1]*e[1]}static dot3(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}static dot4(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}static cross(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}}e.Vector=i},529:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Vertex=void 0,e.Vertex=class{getLength(){return this.getData().flat().length}getAttributeLength(t){return this.getData()[t].length}getAttributeCount(){return this.getData().length}}},532:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Viewport=void 0;const r=i(429);e.Viewport=class{static set(t,e){let i=r.ContextPool.bind;null!=i&&i.gl.viewport(...t,...e)}static get(){let t=r.ContextPool.bind;if(null!=t){let e=t.gl;return e.getParameter(e.VIEWPORT)}return[0,0,0,0]}}},419:function(t,e,i){var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i);var s=Object.getOwnPropertyDescriptor(e,i);s&&!("get"in s?!e.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,r,s)}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),s=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),n=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&r(e,t,i);return s(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.Renderer=void 0;const l=n(i(290)),a=i(365),o=i(624),c=[320,240];class h{static initialize(t,e){if(null!=t){this._element=t,l.Context.create(this._id,t,e),l.Context.bind(this._id);let i=l.Context.getContainer(this._id),r=document.createElement("button"),s=this._id;r.className="devon-webgl-canvas-container",r.innerText="Fullscreen",r.onclick=function(){l.Context.setFullscreen(s)},i.after(r),l.Texture.create("texture_test"),l.Texture.loadImageFile("texture_test","./img/test.png"),l.Texture.createMipmap("texture_test"),o.Sheet.create("sheet_test"),o.Sheet.addFrame("sheet_test","frame0","texture_test",[[0,0],[298,299]],[149,149.5])}}static update(t){if(null!=this._element){l.Context.bind(this._id),l.Viewport.set([0,0],l.Context.getSize()),l.Context.clear([0,0,0,1]);let t=this.getResolution();a.Sprite.draw("sheet_test","frame0",[t[0]/2,t[1]/2],this._angle++*(Math.PI/180),[.5,.5]),a.Sprite.flush(),l.Context.draw()}}static getResolution(){let t=l.Context.getSize();return t[0]>t[1]?[c[1]*(t[0]/t[1]),c[1]]:[c[0],c[0]*(t[1]/t[0])]}}e.Renderer=h,h._id="game",h._angle=0},624:function(t,e,i){var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i);var s=Object.getOwnPropertyDescriptor(e,i);s&&!("get"in s?!e.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,r,s)}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),s=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),n=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&r(e,t,i);return s(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.Sheet=e.SheetFrame=void 0;const l=n(i(290));class a{get width(){return this.bounds[1][0]-this.bounds[0][0]}get height(){return this.bounds[1][1]-this.bounds[0][1]}get left(){return-this.pivot[0]}get right(){return this.left+this.width}get top(){return-this.pivot[1]}get bottom(){return this.top+this.height}get textureLeft(){return this.bounds[0][0]/l.Texture.getWidth(this.textureID)}get textureRight(){return this.bounds[1][0]/l.Texture.getWidth(this.textureID)}get textureTop(){return this.bounds[0][1]/l.Texture.getHeight(this.textureID)}get textureBottom(){return this.bounds[1][1]/l.Texture.getHeight(this.textureID)}constructor(t,e,i,r,s){this.id=t,this.sheetID=e,this.textureID=i,this.bounds=r,this.pivot=s}}e.SheetFrame=a;class o{constructor(){this._frames=new Map}static create(t){this._sheets.set(t,new o)}static addFrame(t,e,i,r,s){var n;null===(n=this._sheets.get(t))||void 0===n||n._frames.set(e,new a(e,t,i,r,s))}static getFrame(t,e){var i;return null===(i=this._sheets.get(t))||void 0===i?void 0:i._frames.get(e)}static deleteFrame(t,e){var i;null===(i=this._sheets.get(t))||void 0===i||i._frames.delete(e)}static delete(t){var e;null===(e=this._sheets.get(t))||void 0===e||e._frames.clear(),this._sheets.delete(t)}static clear(){for(let[t,e]of this._sheets)this.delete(t);this._sheets.clear()}}e.Sheet=o,o._sheets=new Map},365:function(t,e,i){var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i);var s=Object.getOwnPropertyDescriptor(e,i);s&&!("get"in s?!e.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,r,s)}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),s=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),n=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&r(e,t,i);return s(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.Sprite=void 0;const l=n(i(290)),a=i(419),o=i(624);class c extends l.Vertex{constructor(t,e){super(),this.coord=t,this.tex=e}getData(){return[this.coord,this.tex]}}class h{get isFull(){return this._count>=1024}constructor(t){if(this._textureID=t,this._vertices=new Array(4096),this._count=0,this._cursor=0,!h.initialized){l.Shader.create("shader_batch","#version 300 es\n\nlayout (location = 0) in vec2 vecFragCoord;\nlayout (location = 1) in vec2 vecTexCoord;\n\nout vec2 texCoord;\nuniform mat4 projection;\n\nvoid main(void)\n{\n\ttexCoord = vecTexCoord;\n\tgl_Position = projection * vec4(vecFragCoord, 0, 1);\n}\n","#version 300 es\nprecision highp float;\n\nin vec2 texCoord;\nout vec4 fragColor;\nuniform sampler2D tex;\n\nvoid main(void)\n{\n\tfragColor = texture(tex, texCoord);\n}\n"),h.elements=new Array(6144);for(let t=0;t<1024;t++)h.elements[6*t+0]=4*t+0,h.elements[6*t+1]=4*t+1,h.elements[6*t+2]=4*t+2,h.elements[6*t+3]=4*t+1,h.elements[6*t+4]=4*t+0,h.elements[6*t+5]=4*t+3;h.initialized=!0}for(let t=0;t<4096;t++)this._vertices[t]=new c([0,0],[0,0]);this._meshID=`mesh_batch_${this._textureID}`,l.Mesh.createDynamic(this._meshID),l.Mesh.setVertexArray(this._meshID,this._vertices,0),l.Mesh.setElementArray(this._meshID,h.elements,0),l.Mesh.flushVertices(this._meshID),l.Mesh.flushElements(this._meshID)}add(t,e){this._count++,this._vertices[this._cursor].coord=[t[0][0],t[0][1]],this._vertices[this._cursor++].tex=e[0],this._vertices[this._cursor].coord=[t[3][0],t[3][1]],this._vertices[this._cursor++].tex=e[3],this._vertices[this._cursor].coord=[t[1][0],t[1][1]],this._vertices[this._cursor++].tex=e[1],this._vertices[this._cursor].coord=[t[2][0],t[2][1]],this._vertices[this._cursor++].tex=e[2],this.isFull&&this.flush()}flush(){if(0!=this._count){l.Mesh.setVertexArray(this._meshID,this._vertices,0),l.Mesh.flushVertices(this._meshID);let t=l.Matrix.ortho([0,0],a.Renderer.getResolution(),[0,1]);l.Shader.bind("shader_batch"),l.Shader.setMatrix4("projection",t),l.Shader.setTexture("tex",0),l.Texture.setActive(0,this._textureID),l.Mesh.partialDraw(this._meshID,0,6*this._count),this._count=0,this._cursor=0}}delete(){l.Mesh.delete(this._meshID);for(let t=0;t<4096;t++)this._vertices[t]=null}}h.initialized=!1;class u{static draw(t,e,i,r,s){let n=o.Sheet.getFrame(t,e);if(null!=n){let t=this._batches.get(n.textureID);null==t&&(this._batches.set(n.textureID,new h(n.textureID)),t=this._batches.get(n.textureID));let e=l.Matrix.transform2D(i,r,s),a=l.Matrix.multiplyVector(e,[n.left,n.top,0,1]),o=l.Matrix.multiplyVector(e,[n.right,n.top,0,1]),c=l.Matrix.multiplyVector(e,[n.left,n.bottom,0,1]),u=l.Matrix.multiplyVector(e,[n.right,n.bottom,0,1]),d=[n.textureLeft,n.textureTop],_=[n.textureRight,n.textureTop],g=[n.textureLeft,n.textureBottom],v=[n.textureRight,n.textureBottom];t.add([a,o,c,u],[d,_,g,v])}}static flush(){for(let[t,e]of this._batches)e.flush()}static clearBatches(){for(let[t,e]of this._batches)e.delete();this._batches.clear()}static delete(){this.clearBatches(),h.initialized=!1,h.elements=new Array(0),l.Shader.delete("shader_batch")}}e.Sprite=u,u._batches=new Map}},e={};function i(r){var s=e[r];if(void 0!==s)return s.exports;var n=e[r]={exports:{}};return t[r].call(n.exports,n,n.exports,i),n.exports}(()=>{const t=i(419);t.Renderer.initialize(document.getElementById("game"),[320,240]),requestAnimationFrame((function e(i){t.Renderer.update(i),requestAnimationFrame(e)}))})()})();